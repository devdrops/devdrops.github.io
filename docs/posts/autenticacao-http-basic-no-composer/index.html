<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="pt-br" lang="pt-br">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.111.3">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Autentica√ß√£o http-basic no Composer &middot; DevDrops</title>
  <meta name="description" content="" />

  
  <link type="text/css" rel="stylesheet" href="https://devdrops.github.io/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://devdrops.github.io/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://devdrops.github.io/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://devdrops.github.io/css/hyde.css">
  <link type="text/css" rel="stylesheet" href="https://devdrops.github.io/css/authorbox.min.css">
  <link type="text/css" rel="stylesheet" href="https://devdrops.github.io/css/position.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="shortcut icon" href="/favicon.ico">

  
  
</head>

  <body class=" ">
  
<aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://devdrops.github.io/"><h1>DevDrops</h1></a>
      <p class="lead">
      Site pessoal sobre tecnologia e outras coisas mais ;D
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="/about/"> Sobre </a></li><li><a href="/posts/"> Artigos </a></li><li><a href="/talks/"> Palestras </a></li><li><a href="/tags/"> Tags </a></li>
      </ul>
    </nav>

    <p>Davi Moreira - @devdrops<br /> &copy; 2024. Todos os direitos reservados.</p>
  </div>
</aside>

    <main class="content container">
    <section id="main">
  <div class="post">
    <h1 id="title">Autentica√ß√£o http-basic no Composer</h1>
    <div>
      
      
      <h4 id="date" class="post-date">2023-07-18</h4>
      

      
      
      
      <p id="tags">
      <i>
        Tags:
        
        <a href="/tags/php/">PHP</a>, 
        <a href="/tags/composer/">Composer</a>, 
        <a href="/tags/docker/">Docker</a>, 
        <a href="/tags/docker-compose/">Docker-Compose</a>, 
        <a href="/tags/pt-br/">pt-BR</a>
      </i>
      </p>
      

      <article id="content">
        <p>Segue uma dica r√°pida, com uso tanto para ambiente com ou sem Docker üòâ</p>
<h2 id="antes-de-seguir">Antes de Seguir&hellip;</h2>
<p>As instru√ß√µes aqui informam dicas de como usar autentica√ß√£o para download de depend√™ncias com Composer. Meu foco maior √©
usando Docker e Docker Compose, mas os comandos em ess√™ncia podem ser usados em qualquer ambiente.</p>
<h2 id="a-situa√ß√£o">A Situa√ß√£o</h2>
<p>Uma vez, trabalhando com um projeto em PHP, observei que uma das depend√™ncias a instalar com
<a href="https://getcomposer.org/">Composer</a> exigia autentica√ß√£o para o download. O processo era simples: autentica√ß√£o b√°sica,
com usu√°rio e senha. Mas como eu queria algo autom√°tico, precisava de uma forma mais pr√°tica do que informar dados
sens√≠veis &ldquo;na unha&rdquo;. Dado que era uma depend√™ncia privada, e eu estava usando Docker, pensei em como resolver isso de
forma simples e segura.</p>
<h2 id="a-solu√ß√£o">A Solu√ß√£o</h2>
<p>Eu precisava resolver duas coisas:</p>
<ol>
<li>Como passar as informa√ß√µes de senha e usu√°rio para o Composer;</li>
<li>Como fazer isso de forma segura, sem versionar dados sens√≠veis.</li>
</ol>
<h3 id="com-docker-compose">Com Docker Compose</h3>
<h4 id="arquivo-gitignore">Arquivo <code>.gitignore</code>:</h4>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>.env
</span></span><span style="display:flex;"><span>auth.json
</span></span></code></pre></div><p>O arquivo <code>.env</code> √© onde vamos colocar os dados de usu√°rio e senha. Dessa forma, o arquivo ser√° ignorado pelo controle de
vers√£o. J√° o arquivo <code>auth.json</code> ser√° criado automaticamente pelo Composer, e como tamb√©m pode conter informa√ß√µes
sens√≠veis, recomendo que seja tamb√©m ignorado da mesma forma.</p>
<h4 id="arquivo-env">Arquivo <code>.env</code>:</h4>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#40ffff">USUARIO</span>=SECRETUSER
</span></span><span style="display:flex;"><span><span style="color:#40ffff">SENHA</span>=SECRETPASSWORD
</span></span></code></pre></div><p>No arquivo <code>.env</code>, criei duas vari√°veis, uma para o usu√°rio e outra para a senha, ambos no formato <code>NOME=VALOR</code>.</p>
<h4 id="arquivo-docker-composeyml">Arquivo <code>docker-compose.yml</code>:</h4>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">composer</span>:<span style="color:#666">
</span></span></span><span style="display:flex;"><span><span style="color:#666">    </span><span style="color:#6ab825;font-weight:bold">image</span>:<span style="color:#666"> </span>devdrops/php-toolbox:8.2<span style="color:#666">
</span></span></span><span style="display:flex;"><span><span style="color:#666">    </span><span style="color:#6ab825;font-weight:bold">env_file</span>:<span style="color:#666"> </span>.env<span style="color:#666">
</span></span></span><span style="display:flex;"><span><span style="color:#666">    </span><span style="color:#6ab825;font-weight:bold">command</span>:<span style="color:#666"> </span>&gt;<span style="color:#ed9d13">
</span></span></span><span style="display:flex;"><span><span style="color:#ed9d13">        sh -c &#34;composer config http-basic.site.com ${USUARIO} ${SENHA} &amp;&amp; composer install&#34;</span><span style="color:#666">        
</span></span></span><span style="display:flex;"><span><span style="color:#666">    </span><span style="color:#6ab825;font-weight:bold">volumes</span>:<span style="color:#666">
</span></span></span><span style="display:flex;"><span><span style="color:#666">        </span>- .:/app<span style="color:#666">
</span></span></span><span style="display:flex;"><span><span style="color:#666">    </span><span style="color:#6ab825;font-weight:bold">working_dir</span>:<span style="color:#666"> </span>/app<span style="color:#666">
</span></span></span></code></pre></div><p>E no arquivo <code>docker-compose.yml</code>, temos algumas instru√ß√µes importantes:</p>
<ul>
<li>O par√¢metro <code>image</code> aponta para a imagem Docker a ser usada. No caso, a
<a href="https://github.com/devdrops/php-toolbox">devdrops/php-toolbox</a>, que possui Composer e outras ferramentas, usando PHP
8.2.</li>
<li>O par√¢metro <code>env_file</code> aponta o arquivo <code>.env</code> como fonte de vari√°veis de ambiente.</li>
<li>O par√¢metro <code>command</code> tem 2 comandos:
<ol>
<li><code>composer config http-basic.&lt;ENDERE√áO&gt; &lt;USUARIO&gt; &lt;SENHA&gt;</code> instrui ao Composer que para o endere√ßo espec√≠fico, √©
preciso usar o usu√°rio e senha informados.</li>
<li><code>composer install</code>, agora com as instru√ß√£o de autentica√ß√£o, pode instalar as depend√™ncias com sucesso.</li>
</ol>
</li>
<li>Enquanto isso, os demais par√¢metros (<code>volumes</code> e <code>working_dir</code>) servem para uso correto de volumes, de forma que as
altera√ß√µes feitas no container sejam refletidas no mesmo diret√≥rio, na sua m√°quina.</li>
</ul>
<p>No final, ao executar <code>docker-compose up</code>, o Composer ser√° capaz de fazer o download corretamente das depend√™ncias,
privadas ou p√∫blicas.</p>
<h2 id="refer√™ncias">Refer√™ncias</h2>
<ul>
<li><a href="https://getcomposer.org/doc/articles/authentication-for-private-packages.md#http-basic">https://getcomposer.org/doc/articles/authentication-for-private-packages.md#http-basic</a></li>
</ul>
      </article>
    </div>
  </div>
</section>

<hr>

<div>
  
  <i>Post anterior: <a class="previous" href="/posts/mongodb-e-docker/"> MongoDB e Docker</a></i>
  
  <br />
  
  <i>Pr√≥ximo post: <a class="next" href="/posts/vim-definindo-syntax-sem-mudar-filetype/"> Vim: Definindo syntax Sem Mudar filetype</a></i>
  
  <br />
  <br />
</div>




<div class="authorbox clearfix">
  <figure class="authorbox__avatar">
    <img alt="Davi Marcondes Moreira avatar" src="/me/me.jpeg" class="avatar" height="90" width="90">
  </figure>
  <div class="authorbox__header">
    <span class="authorbox__name">Sobre Davi Marcondes Moreira</span>
  </div>
  <div class="authorbox__description">
    Desenvolvedor de software, palestrante, evangelista de trabalho remoto e home office, amante de MTB/XCO e entusiasta de caf√©. Ele/Dele.
  </div>
</div>




    </main>

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-77125737-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    
  </body>
</html>
